## PRD: `catalog` — Local Index + Search CLI (macOS-first)

### Summary

`catalog` is a local-first CLI that indexes a curated set of macOS folders (the places humans actually add stuff) and lets you instantly search for files/apps/config artifacts you installed or created.

---

## Problem

On macOS, “where did that thing go?” is a recurring tax:

* You downloaded something, installed an app, added a CLI tool, dropped a plugin/font, edited a config.
* Weeks later you remember *the name* (or part of it), not the path.
* Spotlight is sometimes slow/noisy/opaque; system-wide indexing is overkill and permission-chaotic.

---

## Goals

* **Fast “I added this to my Mac” search** across the highest-signal locations.
* **Deterministic + local**: predictable results, no cloud dependency.
* **Incremental re-index** with good defaults and safe boundaries.

### Non-goals

* Cloud sync, multi-device, collaboration.
* Full system indexing of `/System`, `/private/var`, `/proc`-like equivalents.
* OCR / PDF extraction in v1.
* AI ranking / semantic embeddings in v1.

---

## Primary user

Power user / developer on macOS who installs tools and moves files around. Wants a fast CLI to locate artifacts.

---

## Key user stories

1. “I installed a CLI tool, what was it called / where is it?”
2. “I downloaded a zip/dmg last month—find it.”
3. “I added a launch agent / config file—where did I put it?”
4. “Show me what changed recently in my ‘user-additions’ zones.”
5. “Tag this file as ‘work’ or ‘infra’ and find it later.”

---

## Default scope: macOS “User Additions” preset

### Default indexed roots (high-signal)

**Personal files**

* `~/Downloads`
* `~/Desktop`
* `~/Documents`
* `~/Developer` or `~/Projects` (if exists)
* `~/Library/Mobile Documents/` (iCloud Drive)

**Apps**

* `/Applications`
* `~/Applications`

**CLI tools**

* `/opt/homebrew` (Apple Silicon Homebrew)
* `/usr/local` (Intel/legacy)
* `~/bin`
* `~/.local/bin`

**Configs & user-level system additions**

* `~/.config`
* `~/Library/Preferences`
* `~/Library/LaunchAgents`

### Optional “Deeper System Additions” (opt-in preset)

* `/Library/LaunchAgents`
* `/Library/LaunchDaemons`
* `/Library/Fonts`, `~/Library/Fonts`
* `/Library/PreferencePanes`, `~/Library/PreferencePanes`
* `/etc` (rare, but useful)

### Default excludes (must-have noise filters)

* `~/Library/Caches`
* `~/Library/Containers`
* `~/Library/Logs`
* Dev/build junk: `**/.git/**`, `**/node_modules/**`, `**/target/**`, `**/dist/**`, `**/build/**`
* Xcode: `~/Library/Developer/Xcode/DerivedData`

---

## Product requirements

### Commands (V1)

* `catalog init [--preset macos-user-additions|macos-deep]`

    * Creates config + JSON store location.
* `catalog roots`

    * Show included roots + excludes + last index time.
* `catalog add <path>...`

    * Add custom roots.
* `catalog rm <path>...`

    * Remove roots.
* `catalog index [--full] [--one-filesystem]`

    * Scan roots, update store; `--full` forces full rescan.
* `catalog search <query> [--ext ...] [--tag ...] [--after ...] [--before ...] [--root ...] [--json]`

    * Case-insensitive search over filename + path (substring).
* `catalog recent [--days N] [--limit N]`

    * List recently modified/added files in indexed roots.
* `catalog tag add <path|id> <tag>`
* `catalog tag rm <path|id> <tag>`
* `catalog tags`

    * List tags + counts.

### Search behavior (V1)

* Matches on: filename + full path (case-insensitive).
* Filters:

    * `--ext rs,md,dmg,pkg,app`
    * `--after YYYY-MM-DD`, `--before YYYY-MM-DD`
    * `--min-size`, `--max-size`
    * `--root <root>`
    * `--tag <tag>`
* Output:

    * Default: `id  mtime  size  path`
    * `--json` for scripting.

### Indexing behavior (V1)

* Walk directories recursively.
* Do **metadata-only** indexing:

    * path, size, modified time, file type (file/dir/symlink), extension
* Change detection:

    * Treat changed when `(size, mtime)` differs.
* Deletions:

    * Mark as deleted (soft delete) when missing in a run.
* Symlinks:

    * Default: do not follow (avoid cycles); can index symlink node itself.

### Config (TOML)

* Roots list
* Excludes (gitignore-style)
* `include_hidden` (default false)
* `one_filesystem` default true for system-ish roots
* Output defaults (json/plain)

---

## Data model (JSON store)

Minimal collections:

* `roots(id, path, added_at, preset_name?, last_indexed_at, one_filesystem)`
* `files(id, root_id, rel_path, abs_path, is_dir, is_symlink, size, mtime, ext, status, last_seen_run)`
* `tags(id, name)`
* `file_tags(file_id, tag_id)`

(Stretch for better rename detection later: store inode/device on Unix.)

---

## Non-functional requirements

* Works on macOS (primary). Linux support is a bonus; Windows optional.
* Must handle permission errors gracefully (log + continue).
* Indexing should be incremental and not re-process unchanged files heavily.
* Scale target: 100k–500k entries without becoming unusably slow.

---

## Metrics / success criteria

* Time to first useful result: user can `init → index → search` in minutes.
* Median `search` response: <100ms on typical store sizes.
* Re-index with no changes: very fast (seconds).
* User perceived “signal”: default preset yields relevant results without obvious spam folders.

---

## Milestones

**MVP (V1)**

* Presets + roots management
* Metadata indexing + soft deletes
* Search + recent
* Tags
* Config file + JSON store

**V1.1**

* `catalog watch` (filesystem notifications + fallback polling)
* Better rename/move detection (inode/device)

**V2 (content indexing)**

* Optional full-text indexing for text files (implementation TBD)
* Snippets + ranked search
* File size caps + binary detection

---

## Risks & mitigations

* **Indexing too much** → strong preset defaults + excludes + one-filesystem boundary.
* **Permissions noise** → concise warnings + summary at end (“skipped 312 paths due to permissions”).
* **macOS folder weirdness** (iCloud/containers) → keep as opt-in or excluded by default.

---

## Suggested Rust stack

* CLI: `clap`
* Walking: `walkdir` + `ignore` (gitignore-style excludes)
* Storage: JSON store on filesystem (no DB dependency)
* Config: `toml` + `serde`
* Logging: `tracing`

---

If you want the next step, I’ll translate this PRD into an **implementation checklist + module structure** (commands, indexing pipeline, store layer, ignore matcher) so you can start coding without architecture thrash.
